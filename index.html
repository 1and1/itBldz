<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Itbldz by 1and1</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Itbldz</h1>
        <h2>MyWebsite Build-Tools - The only build-tools you&#39;ll ever need</h2>

        <section id="downloads">
          <a href="https://github.com/1and1/itBldz/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/1and1/itBldz/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/1and1/itBldz" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="itbldz-build-tools" class="anchor" href="#itbldz-build-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>itBldz Build-Tools</h1>

<p><strong>The only build-tool you'll ever need</strong></p>

<p>The goal is to provide an easy to setup framework which allow every development team a "closed for modification, open for extension"-plattform for their own needs.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h3>

<p>Install itBldz</p>

<div class="highlight highlight-shell"><pre>npm install itbldz</pre></div>

<p>create your config</p>

<div class="highlight highlight-shell"><pre><span class="pl-s3">echo</span> <span class="pl-s1"><span class="pl-pds">'</span>{ "say-hi" : { "helloworld" : { "task" : "helloworld", "package" : "grunt-helloworld", "dummytarget": {} } } }<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> build.json
<span class="pl-s3">echo</span> <span class="pl-s1"><span class="pl-pds">'</span>{ }<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> config.json</pre></div>

<p>setup the build with your config</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/bpm setup</pre></div>

<p>execute</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/build</pre></div>

<p>in the shell / commandline</p>

<h3>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h3>

<p>All your arguments will be passed to grunt.</p>

<p>Examples:</p>

<p>Verbose output:</p>

<blockquote>
<p>build --verbose</p>
</blockquote>

<p>Run only tests</p>

<blockquote>
<p>build test</p>
</blockquote>

<p>Run only tests but verbose</p>

<blockquote>
<p>build test --verbose</p>
</blockquote>

<p>Get all tasks with description</p>

<blockquote>
<p>build --help</p>
</blockquote>

<p>Get configs for a specific target (see )</p>

<h3>
<a id="configure-for-your-use-case" class="anchor" href="#configure-for-your-use-case" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure for your use case</h3>

<p>To include this project, all you have to do is to configure the build.json and
the config.json.</p>

<h4>
<a id="buildjson" class="anchor" href="#buildjson" aria-hidden="true"><span class="octicon octicon-link"></span></a>build.json</h4>

<p><strong>What to do</strong></p>

<p>The build.json is the task-template. It orchestrates the build, and is separated
into build-steps, task-groups and tasks.</p>

<h5>
<a id="build-steps" class="anchor" href="#build-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>build-steps</h5>

<p>The build-step is the first layer. It defines the main tasks of the build. You
should use a natural language that fits your build-pipeline best.
Typical steps would be:</p>

<ul>
<li>
<em>prepare</em> - prepares the build-environment</li>
<li>
<em>validate</em> - validates the source for syntax, sematics and style conformance</li>
<li>
<em>compile</em> - compiles the source code</li>
<li>
<em>test</em> - runs unit and quality (i.e. coverage) tests</li>
<li>
<em>create-deployable</em> - creates a deployable package for your code</li>
<li>
<em>publish</em> - publishes your deployable package to your environment</li>
</ul>

<h5>
<a id="task-groups" class="anchor" href="#task-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>task-groups</h5>

<p>Task-groups are containers for other task-groups and tasks. They do not run
by itself, but rather orchestrate the task-groups and tasks they contain.
They are used to organize build-steps, and should use a natural language that
describe their use best.
An example would be:</p>

<ul>
<li>validate

<ul>
<li>
<em>syntax</em> - syntax check of the language</li>
<li>
<em>semantic</em> - semantic check of the language</li>
</ul>
</li>
</ul>

<h5>
<a id="tasks" class="anchor" href="#tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>tasks</h5>

<p>Tasks are the hard and soul, and are basically runners for grunt-tasks. They can
have arbitrary names and should describe best what they do, not what grunt task
they are using.
Which grunt-task they run is specified by the properties <em>task</em> and <em>package</em>.
The <em>task</em> field specifies the name of the grunt-task that should be run, while
the <em>package</em> field specifies which npm package is required to run the task.
<strong>Note</strong>: itBldz will install all required packages automatically. There is no
action required on your side.
An example for tasks would be:  </p>

<ul>
<li>validate

<ul>
<li>syntax

<ul>
<li>
<em>js</em>[task=jshint;package=grunt-contrib-jshint]<br>
</li>
</ul>
</li>
<li>
<em>php</em>[task=phplint;package=grunt-phplint]<br>
</li>
</ul>
</li>
</ul>

<p>The build.json is to be the same on every environment you run the build.</p>

<h4>
<a id="configjson" class="anchor" href="#configjson" aria-hidden="true"><span class="octicon octicon-link"></span></a>config.json</h4>

<p><strong>Where to do it</strong></p>

<p>The config.json is describing the environment the build is running in. It is
used to control the directories, file-patterns, or environmental specifics.
You can use all variables in the config.json in your build.json by typing</p>

<blockquote>
<p>&lt;%= config.YOURKEY %&gt;</p>
</blockquote>

<p>An example would be:</p>

<div class="highlight highlight-json"><pre>    {
      <span class="pl-s1"><span class="pl-pds">"</span>directories<span class="pl-pds">"</span></span> : {
        <span class="pl-s1"><span class="pl-pds">"</span>sources<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>sources<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>output<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>target<span class="pl-pds">"</span></span>
      },
      <span class="pl-s1"><span class="pl-pds">"</span>filesets<span class="pl-pds">"</span></span> : {
        <span class="pl-s1"><span class="pl-pds">"</span>php<span class="pl-pds">"</span></span> : [<span class="pl-s1"><span class="pl-pds">"</span>**/*.php<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>!**/framework/**<span class="pl-pds">"</span></span>]
      }
    }
</pre></div>

<p>Make sure the configuration natively reflects the language on how you are
talking about your environment.</p>

<p>For different environments you might have different configurations. Split them
and reference the correct config when starting the build.</p>

<h4>
<a id="environment" class="anchor" href="#environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environment</h4>

<p>In your configuration and build you can access the environment variables of your host system as well.</p>

<p>Add the Statement</p>

<blockquote>
<p>&lt;%= env.ENV_VARIABLE %&gt;</p>
</blockquote>

<p>and it will automatically be replaced.</p>

<h4>
<a id="create-your-configured-build" class="anchor" href="#create-your-configured-build" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create your configured build</h4>

<p>Once your done configuring the build, call</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/bpm setup</pre></div>

<p>on the folder and the build will be created automatically.</p>

<p>If you want to add an additional module not in the configuration (which you
don't want to do, you really want it all the configuration and not call manually,
but it's always nice to know you could) you can call</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/bpm add --m buildstep/module --t Taskname --p some-grunt-package</pre></div>

<p>And the module will be added automatically to the buildstep. Note that this will
not actually run the module as long as it is not configured in the build.json</p>

<h4>
<a id="adjust-build-for-different-environments" class="anchor" href="#adjust-build-for-different-environments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adjust build for different environments</h4>

<p>Occasionally your environments are not the same from dev to live, and you want
to adjust stuff. Most probably sensitive information you don't want to share
on github.com.</p>

<p>To achieve this, you can overwrite parts of the configuration (or the complete
configuration) with target-files in the format "config.[target].json" by
passing the following arguments to itbldz:</p>

<ul>
<li>
<em>target</em> : string - The target to address</li>
<li>
<em>target-path</em> : string - The path to the target files. Defaults to current path</li>
<li>
<em>target-overwrite</em> (short: o) : boolean - If true, the leaf will be replaced by the target
(default false)</li>
</ul>

<p>Example:</p>

<div class="highlight highlight-json"><pre>{
    <span class="pl-s1"><span class="pl-pds">"</span>other<span class="pl-pds">"</span></span> : {},
    <span class="pl-s1"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span>: {
        <span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>123<span class="pl-pds">"</span></span>
    },
    <span class="pl-s1"><span class="pl-pds">"</span>stuff<span class="pl-pds">"</span></span> : {}
}</pre></div>

<p><em>config.json</em></p>

<div class="highlight highlight-json"><pre>{
    <span class="pl-s1"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span>: {
        <span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>dbserver.corp.contoso.com<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>1433<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>web<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>&lt;%= env.PASSWORD %&gt;<span class="pl-pds">"</span></span>
    }
}</pre></div>

<p><em>config.live.json</em></p>

<p>when calling</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/build --target=live</pre></div>

<p>The resulting config will look like:</p>

<div class="highlight highlight-json"><pre>{
    <span class="pl-s1"><span class="pl-pds">"</span>other<span class="pl-pds">"</span></span> : {},
    <span class="pl-s1"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span>: {
        <span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>dbserver.corp.contoso.com<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-s1"><span class="pl-pds">"</span>1433<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>web<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>&lt;%= env.PASSWORD %&gt;<span class="pl-pds">"</span></span>
    },
    <span class="pl-s1"><span class="pl-pds">"</span>stuff<span class="pl-pds">"</span></span> : {}
}</pre></div>

<p><strong>NOTE:</strong> You can only override defined steps in the master, you cannot add additional steps. Why? Because your deployment should be the same over all environments.</p>

<p><strong>But my deployment to dev &amp; live is very VERY differnet!</strong> Then you will have to add both to the master, and then override and thus deleting it for every environment.</p>

<h2>
<a id="deving" class="anchor" href="#deving" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deving</h2>

<h3>
<a id="guidelines" class="anchor" href="#guidelines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Guidelines</h3>

<p>You are free to extend the project as you wish. Every new code has to include
unit tests and result in a green build when building the build-tools executing</p>

<div class="highlight highlight-shell"><pre>./node_modules/itbldz/build</pre></div>

<h3>
<a id="working-with-the-task-engine" class="anchor" href="#working-with-the-task-engine" aria-hidden="true"><span class="octicon octicon-link"></span></a>Working with the task engine</h3>

<p>The build-tools are using a simple task engine which allow for task aliasing and
automatic dependency resolving in npm.
Using the task engine you can easily extend the core of the build-tools. The bpm
tools are following the conventions by the task engine to prepare the build.</p>

<p>A build config step should look like the following to get you started:</p>

<div class="highlight highlight-json"><pre>{
  <span class="pl-s1"><span class="pl-pds">"</span>build-step<span class="pl-pds">"</span></span> : {
    <span class="pl-s1"><span class="pl-pds">"</span>task<span class="pl-pds">"</span></span> : {
      <span class="pl-s1"><span class="pl-pds">"</span>task<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>clean<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span> : <span class="pl-s1"><span class="pl-pds">"</span>grunt-contrib-clean<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>options<span class="pl-pds">"</span></span>: { <span class="pl-s1"><span class="pl-pds">"</span>force<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span> },
      <span class="pl-s1"><span class="pl-pds">"</span>target<span class="pl-pds">"</span></span>: [ <span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span> ]
    }
  }  
}</pre></div>

<p>When confronted with such a build-step, the folder structure expected by the
task engine is:</p>

<pre><code>  build-tools
  |_ .build
    |_ build-step
      |_ task
        task.js
      build-step.js
    gruntfile.js
  build.json
  config.json
</code></pre>

<p>When opening the build-step.js file you see the following code:</p>

<div class="highlight highlight-js"><pre><span class="pl-s">var</span> conf <span class="pl-k">=</span> requireRoot(<span class="pl-s1"><span class="pl-pds">'</span>conf<span class="pl-pds">'</span></span>), path <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>path<span class="pl-pds">"</span></span>);
<span class="pl-s">var</span> taskengine <span class="pl-k">=</span> requireRoot(<span class="pl-s1"><span class="pl-pds">'</span>taskengine<span class="pl-pds">'</span></span>);

<span class="pl-s3">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vpf">grunt</span>) {
  <span class="pl-s">var</span> taskContext <span class="pl-k">=</span> taskengine.startup({
    <span class="pl-s1"><span class="pl-pds">"</span>grunt<span class="pl-pds">"</span></span> <span class="pl-k">:</span> grunt,
    <span class="pl-s1"><span class="pl-pds">"</span>buildStep<span class="pl-pds">"</span></span> <span class="pl-k">:</span> path.basename(<span class="pl-sv">__filename</span>, <span class="pl-s1"><span class="pl-pds">"</span>.js<span class="pl-pds">"</span></span>),
    <span class="pl-s1"><span class="pl-pds">"</span>path<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-sv">__dirname</span>
  });

  taskengine.run(taskContext);
};</pre></div>

<p>The build-step simply starts up the taskengine and registers itself. Then
running the taskengine.</p>

<p>Next open the task.js.</p>

<div class="highlight highlight-js"><pre><span class="pl-s">var</span> conf <span class="pl-k">=</span> requireRoot(<span class="pl-s1"><span class="pl-pds">'</span>conf<span class="pl-pds">'</span></span>);

<span class="pl-s">var</span> taskengine <span class="pl-k">=</span> requireRoot(<span class="pl-s1"><span class="pl-pds">'</span>lib/taskengine/te<span class="pl-pds">'</span></span>);

<span class="pl-s3">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vpf">grunt</span>) {
  taskengine <span class="pl-k">=</span> taskengine({
    <span class="pl-s1"><span class="pl-pds">"</span>parent<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>build-step<span class="pl-pds">"</span></span>,
    <span class="pl-s1"><span class="pl-pds">"</span>options<span class="pl-pds">"</span></span> <span class="pl-k">:</span> {
      <span class="pl-s1"><span class="pl-pds">"</span>task<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>clean<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>grunt-contrib-clean<span class="pl-pds">"</span></span>
    }
  });

  taskengine.runSubtask(<span class="pl-s1"><span class="pl-pds">"</span>clean<span class="pl-pds">"</span></span>,
    <span class="pl-s1"><span class="pl-pds">"</span>Cleaning everything from a directory<span class="pl-pds">"</span></span>,
    grunt,
    grunt.config(<span class="pl-s1"><span class="pl-pds">"</span>build<span class="pl-pds">"</span></span>)[<span class="pl-s1"><span class="pl-pds">"</span>build-step<span class="pl-pds">"</span></span>].task);
};</pre></div>

<p>The task itself is registering itself, referencing the parent build-step, and
then running the subtask.</p>
      </section>
    </div>

    
  </body>
</html>